@using AutomacaoFolhaPagamento.Models;

@{
    ViewData["Title"] = "Relatório Funcionário";
}
@model FuncionarioViewModel

<style>
    body {
        font-family: 'Arial', sans-serif;
    }

    .folha-pagamento {
        border: 1px solid #333;
        padding: 30px;
        width: 80%;
        margin: 20px auto;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
    }

        .header h2 {
            margin: 0;
            color: #444;
        }

        .header p {
            margin: 5px 0;
            font-style: italic;
            color: #666;
        }

    .info-group {
        margin-bottom: 10px;
    }

    .info-title {
        font-weight: bold;
        width: 30%;
        display: inline-block;
        color: #333;
    }

    .info-content {
        display: inline-block;
        border-bottom: 1px dashed #333;
        width: 65%;
        color: #555;
    }

    #gerarPDF {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

        #gerarPDF:hover {
            background-color: #0056b3;
        }
</style>

<div class="w-100" style="background-color: #fafafa; border-top-right-radius: 8px; border-bottom-right-radius: 8px; margin-top: 32px">
    <div >
        <div style="">
            <h4 class="mt-3 mb-3">Relatório de Funcionario Folha</h4>
        </div>


        <form asp-controller="Relatorio" asp-action="Funcionario" method="post" class="d-flex flex-wrap">

            <!-- Selecione o Funcionário -->
            <div class="form-group col-md-8">
                <label for="funcionario">Selecione o Funcionário</label>
                <select id="funcionario" name="Funcionario" class="form-control">
                    <option value="" selected>Selecione um funcionário</option>
                    @foreach (var funcionario in Model.funcionarioBasicoList)
                    {
                        <option value="@funcionario.cpf">@funcionario.cpf - @funcionario.nomeFuncionario</option>
                    }
                </select>
            </div>

            <!-- Selecione o Mês -->
            <div class="form-group col-md-8">
                <label for="mes">Selecione o Mês</label>
                <select id="mes" name="MesSelecionado" class="form-control">
                    <option value="1">Janeiro</option>
                    <option value="2">Fevereiro</option>
                    <option value="3">Março</option>
                    <option value="4">Abril</option>
                    <option value="5">Maio</option>
                    <option value="6">Junho</option>
                    <option value="7">Julho</option>
                    <option value="8">Agosto</option>
                    <option value="9">Setembro</option>
                    <option value="10">Outubro</option>
                    <option value="11">Novembro</option>
                    <option value="12">Dezembro</option>
                    <option value="13">Todos</option>
                </select>
            </div>

            <!-- Botão de Submit -->
            <div class="form-group col-md-12 " style="text-align:right">
                <button type="submit" class="btn btn-primary">Gerar Relatório</button>
            </div>

        </form>

    </div>

        <div class="folha-pagamento">
      
            @if (Model.funcionarioDeducoesList != null)
            {
            @if (Model.funcionarioDeducoesList.Any())
            {
                foreach (var item in Model.funcionarioDeducoesList)
                {
                    <p class="info-group"><span class="info-title">Nome:</span> <span class="info-content">@item.nomeFuncionario</span></p>
                    <p class="info-group"><span class="info-title">CPF:</span> <span class="info-content">@item.cpf</span></p>
                    <p class="info-group"><span class="info-title">Cargo:</span> <span class="info-content">@item.cargo</span></p>
                    <p class="info-group"><span class="info-title">Departamento:</span> <span class="info-content">@item.departamento</span></p>
                    <p class="info-group"><span class="info-title">INSS:</span> <span class="info-content">@item.inss</span></p>
                    <p class="info-group"><span class="info-title">FGTS:</span> <span class="info-content">@item.fgts</span></p>
                    <p class="info-group"><span class="info-title">IR:</span> <span class="info-content">@item.ir</span></p>
                    <p class="info-group"><span class="info-title">VR:</span> <span class="info-content">@item.vr</span></p>
                    <p class="info-group"><span class="info-title">VT:</span> <span class="info-content">@item.vt</span></p>
                    <p class="info-group"><span class="info-title">Valor Líquido:</span> <span class="info-content">@item.valorLiquido</span></p>
                    <p class="info-group"><span class="info-title">Salário:</span> <span class="info-content">@item.salario</span></p>
                    <p class="info-group"><span class="info-title">Descontos:</span> <span class="info-content">@item.descontos</span></p>
                }
            }
            else
            {
                <script>
                    alert('Não consta pagamento nesta competencia');
                </script>
            }
            }

        
        </div>

    <button id="gerarPDF">Gerar PDF</button>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.9/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>

    
<script type="module">
    document.getElementById('gerarPDF').addEventListener('click', function () {
        var folhaPagamento = document.querySelector('.folha-pagamento');

        html2canvas(folhaPagamento).then(canvas => {
            var imgData = canvas.toDataURL('image/png');
            var doc = new jsPDF('p', 'mm');
            var imgHeight = canvas.height * 210 / canvas.width;
            doc.addImage(imgData, 'PNG', 0, 0, 210, imgHeight);
            doc.save('relatorio.pdf');
        });
    });
</script>